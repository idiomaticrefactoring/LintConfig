{
  "name": "bugprone-suspicious-enum-usage",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/suspicious-enum-usage.html",
    "fixable": false
  },
  "content": {
    "introduction": "The checker detects various cases when an enum is probably misused\n(as a bitmask).\n\nWhen âADDâ or âbitwise ORâ is used between two enum which come\nfrom different types and these types value ranges are not disjoint.\n\nThe following cases will be investigated only using \nStrictMode\n. We\nregard the enum as a (suspicious)\nbitmask if the three conditions below are true at the same time:\n\nat most half of the elements of the enum are non pow-of-2 numbers (because of\nshort enumerations)\n\n\nthere is another non pow-of-2 number than the enum constant representing all\nchoices (the result âbitwise ORâ operation of all enum elements)\n\n\nenum type variable/enumconstant is used as an argument of a \n+\n or âbitwise\nORâ operator\n\nSo whenever the non pow-of-2 element is used as a bitmask element we diagnose a\nmisuse and give a warning.\n\nInvestigating the right hand side of \n+=\n and \n|=\n operator.\n\n\nCheck only the enum value side of a \n|\n and \n+\n operator if one of\nthem is not enum val.\n\n\nCheck both side of \n|\n or \n+\n operator where the enum values are from\nthe same enum type.\n\nExamples:\n\nenum\n \n{\n \nA\n,\n \nB\n,\n \nC\n \n};\n\n\nenum\n \n{\n \nD\n,\n \nE\n,\n \nF\n \n=\n \n5\n \n};\n\n\nenum\n \n{\n \nG\n \n=\n \n10\n,\n \nH\n \n=\n \n11\n,\n \nI\n \n=\n \n12\n \n};\n\n\n\nunsigned\n \nflag\n;\n\n\nflag\n \n=\n\n\n    \nA\n \n|\n\n\n    \nH\n;\n \n// OK, disjoint value intervals in the enum types ->probably good use.\n\n\nflag\n \n=\n \nB\n \n|\n \nF\n;\n \n// Warning, have common values so they are probably misused.\n\n\n\n// Case 2:\n\n\nenum\n \nBitmask\n \n{\n\n\n  \nA\n \n=\n \n0\n,\n\n\n  \nB\n \n=\n \n1\n,\n\n\n  \nC\n \n=\n \n2\n,\n\n\n  \nD\n \n=\n \n4\n,\n\n\n  \nE\n \n=\n \n8\n,\n\n\n  \nF\n \n=\n \n16\n,\n\n\n  \nG\n \n=\n \n31\n \n// OK, real bitmask.\n\n\n};\n\n\n\nenum\n \nAlmostbitmask\n \n{\n\n\n  \nAA\n \n=\n \n0\n,\n\n\n  \nBB\n \n=\n \n1\n,\n\n\n  \nCC\n \n=\n \n2\n,\n\n\n  \nDD\n \n=\n \n4\n,\n\n\n  \nEE\n \n=\n \n8\n,\n\n\n  \nFF\n \n=\n \n16\n,\n\n\n  \nGG\n \n// Problem, forgot to initialize.\n\n\n};\n\n\n\nunsigned\n \nflag\n \n=\n \n0\n;\n\n\nflag\n \n|=\n \nE\n;\n \n// OK.\n\n\nflag\n \n|=\n\n\n    \nEE\n;\n \n// Warning at the decl, and note that it was used here as a bitmask.\n\nOptions\nÂ¶\n\n\n\n\n\n\nStrictMode\nÂ¶\n\n\nDefault value: 0.\nWhen non-null the suspicious bitmask usage will be investigated additionally\nto the different enum usage check.",
    "configurations": []
  }
}