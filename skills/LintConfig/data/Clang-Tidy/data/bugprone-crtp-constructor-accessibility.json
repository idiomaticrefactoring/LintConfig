{
  "name": "bugprone-crtp-constructor-accessibility",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/crtp-constructor-accessibility.html",
    "fixable": true
  },
  "content": {
    "introduction": "Detects error-prone Curiously Recurring Template Pattern usage, when the CRTP\ncan be constructed outside itself and the derived class.\n\nThe CRTP is an idiom, in which a class derives from a template class, where\nitself is the template argument. It should be ensured that if a class is\nintended to be a base class in this idiom, it can only be instantiated if\nthe derived class is its template argument.\n\nExample:\n\ntemplate\n \n<\ntypename\n \nT\n>\n \nclass\n \nCRTP\n \n{\n\n\nprivate\n:\n\n\n  \nCRTP\n()\n \n=\n \ndefault\n;\n\n\n  \nfriend\n \nT\n;\n\n\n};\n\n\n\nclass\n \nDerived\n \n:\n \nCRTP\n<\nDerived\n>\n \n{};\n\nBelow can be seen some common mistakes that will allow the breaking of the\nidiom.\n\nIf the constructor of a class intended to be used in a CRTP is public, then\nit allows users to construct that class on its own.\n\nExample:\n\ntemplate\n \n<\ntypename\n \nT\n>\n \nclass\n \nCRTP\n \n{\n\n\npublic\n:\n\n\n  \nCRTP\n()\n \n=\n \ndefault\n;\n\n\n};\n\n\n\nclass\n \nGood\n \n:\n \nCRTP\n<\nGood\n>\n \n{};\n\n\nGood\n \nGoodInstance\n;\n\n\n\nCRTP\n<\nint\n>\n \nBadInstance\n;\n\nIf the constructor is protected, the possibility of an accidental instantiation\nis prevented, however it can fade an error, when a different class is used as\nthe template parameter instead of the derived one.\n\nExample:\n\ntemplate\n \n<\ntypename\n \nT\n>\n \nclass\n \nCRTP\n \n{\n\n\nprotected\n:\n\n\n  \nCRTP\n()\n \n=\n \ndefault\n;\n\n\n};\n\n\n\nclass\n \nGood\n \n:\n \nCRTP\n<\nGood\n>\n \n{};\n\n\nGood\n \nGoodInstance\n;\n\n\n\nclass\n \nBad\n \n:\n \nCRTP\n<\nGood\n>\n \n{};\n\n\nBad\n \nBadInstance\n;\n\nTo ensure that no accidental instantiation happens, the best practice is to\nmake the constructor private and declare the derived class as friend. Note\nthat as a tradeoff, this also gives the derived class access to every other\nprivate members of the CRTP. However, constructors can still be public or\nprotected if they are deleted.\n\nExample:\n\ntemplate\n \n<\ntypename\n \nT\n>\n \nclass\n \nCRTP\n \n{\n\n\n  \nCRTP\n()\n \n=\n \ndefault\n;\n\n\n  \nfriend\n \nT\n;\n\n\n};\n\n\n\nclass\n \nGood\n \n:\n \nCRTP\n<\nGood\n>\n \n{};\n\n\nGood\n \nGoodInstance\n;\n\n\n\nclass\n \nBad\n \n:\n \nCRTP\n<\nGood\n>\n \n{};\n\n\nBad\n \nCompileTimeError\n;\n\n\n\nCRTP\n<\nint\n>\n \nAlsoCompileTimeError\n;\n\nLimitations\nÂ¶\n\n\n\n\nThe check is not supported below C++11\n\n\nThe check does not handle when the derived class is passed as a variadic\ntemplate argument\n\n\nAccessible functions that can construct the CRTP, like factory functions\nare not checked\n\n\n\n\nThe check also suggests a fix-its in some cases.",
    "configurations": []
  }
}