{
  "name": "modernize-use-scoped-lock",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/modernize/use-scoped-lock.html",
    "fixable": true
  },
  "content": {
    "introduction": "Finds uses of \nstd::lock_guard\n and suggests replacing them with C++17âs\nalternative \nstd::scoped_lock\n.\n\nFix-its are provided for single declarations of \nstd::lock_guard\n and warning\nis emitted for multiple declarations of \nstd::lock_guard\n that can be\nreplaced with a single declaration of \nstd::scoped_lock\n.\n\nExamples\nÂ¶\n\n\nSingle \nstd::lock_guard\n declaration:\n\n\nstd\n::\nmutex\n \nM\n;\n\n\nstd\n::\nlock_guard\n<\nstd\n::\nmutex\n>\n \nL\n(\nM\n);\n\n\n\n\n\n\nTransforms to:\n\n\nstd\n::\nmutex\n \nM\n;\n\n\nstd\n::\nscoped_lock\n \nL\n(\nM\n);\n\n\n\n\n\n\nSingle \nstd::lock_guard\n declaration with \nstd::adopt_lock\n:\n\n\nstd\n::\nmutex\n \nM\n;\n\n\nstd\n::\nlock\n(\nM\n);\n\n\nstd\n::\nlock_guard\n<\nstd\n::\nmutex\n>\n \nL\n(\nM\n,\n \nstd\n::\nadopt_lock\n);\n\n\n\n\n\n\nTransforms to:\n\n\nstd\n::\nmutex\n \nM\n;\n\n\nstd\n::\nlock\n(\nM\n);\n\n\nstd\n::\nscoped_lock\n \nL\n(\nstd\n::\nadopt_lock\n,\n \nM\n);\n\n\n\n\n\n\nMultiple \nstd::lock_guard\n declarations only emit warnings:\n\n\nstd\n::\nmutex\n \nM1\n,\n \nM2\n;\n\n\nstd\n::\nlock\n(\nM1\n,\n \nM2\n);\n\n\nstd\n::\nlock_guard\n \nLock1\n(\nM1\n,\n \nstd\n::\nadopt_lock\n);\n \n// warning: use single 'std::scoped_lock' instead of multiple 'std::lock_guard'\n\n\nstd\n::\nlock_guard\n \nLock2\n(\nM2\n,\n \nstd\n::\nadopt_lock\n);\n \n// note: additional 'std::lock_guard' declared here\n\nLimitations\nÂ¶\n\n\nThe check will not emit warnings if \nstd::lock_guard\n is used implicitly via\n\ntemplate\n parameter:\n\n\ntemplate\n \n<\ntemplate\n \n<\ntypename\n>\n \ntypename\n \nLock\n>\n\n\nvoid\n \nTemplatedLock\n()\n \n{\n\n\n  \nstd\n::\nmutex\n \nM\n;\n\n\n  \nLock\n<\nstd\n::\nmutex\n>\n \nL\n(\nM\n);\n \n// no warning\n\n\n}\n\n\n\nvoid\n \ninstantiate\n()\n \n{\n\n\n  \nTemplatedLock\n<\nstd\n::\nlock_guard\n>\n();\n\n\n}\n\nOptions\nÂ¶\n\n\n\n\n\n\nWarnOnSingleLocks\nÂ¶\n\n\nWhen \ntrue\n, the check will warn on single \nstd::lock_guard\n declarations.\nSet this option to \nfalse\n if you want to get warnings only on multiple\n\nstd::lock_guard\n declarations that can be replaced with a single\n\nstd::scoped_lock\n. Default is \ntrue\n.\n\n\n\n\n\n\n\n\nWarnOnUsingAndTypedef\nÂ¶\n\n\nWhen \ntrue\n, the check will emit warnings if \nstd::lock_guard\n is used\nin \nusing\n or \ntypedef\n context. Default is \ntrue\n.\n\n\ntemplate\n \n<\ntypename\n \nT\n>\n\n\nusing\n \nLock\n \n=\n \nstd\n::\nlock_guard\n<\nT\n>\n;\n \n// warning: use 'std::scoped_lock' instead of 'std::lock_guard'\n\n\n\nusing\n \nLockMutex\n \n=\n \nstd\n::\nlock_guard\n<\nstd\n::\nmutex\n>\n;\n \n// warning: use 'std::scoped_lock' instead of 'std::lock_guard'\n\n\n\ntypedef\n \nstd\n::\nlock_guard\n<\nstd\n::\nmutex\n>\n \nLockDef\n;\n \n// warning: use 'std::scoped_lock' instead of 'std::lock_guard'\n\n\n\nusing\n \nstd\n::\nlock_guard\n;\n \n// warning: use 'std::scoped_lock' instead of 'std::lock_guard'",
    "configurations": []
  }
}