{
  "name": "performance-no-int-to-ptr",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/performance/no-int-to-ptr.html",
    "fixable": false
  },
  "content": {
    "introduction": "Diagnoses every integer to pointer cast.\n\nWhile casting an (integral) pointer to an integer is obvious - you just get\nthe integral value of the pointer, casting an integer to an (integral) pointer\nis deceivingly different. While you will get a pointer with that integral\nvalue, if you got that integral value via a pointer-to-integer cast originally,\nthe new pointer will lack the provenance information from the original pointer.\n\nSo while (integral) pointer to integer casts are effectively no-ops,\nand are transparent to the optimizer, integer to (integral) pointer casts\nare \nNOT\n transparent, and may conceal information from optimizer.\n\nWhile that may be the intention, it is not always so. For example,\nletâs take a look at a routine to align the pointer up to the multiple of 16:\nThe obvious, naive implementation for that is:\n\nchar\n*\n \nsrc\n(\nchar\n*\n \nmaybe_underbiased_ptr\n)\n \n{\n\n\n  \nuintptr_t\n \nmaybe_underbiased_intptr\n \n=\n \n(\nuintptr_t\n)\nmaybe_underbiased_ptr\n;\n\n\n  \nuintptr_t\n \naligned_biased_intptr\n \n=\n \nmaybe_underbiased_intptr\n \n+\n \n15\n;\n\n\n  \nuintptr_t\n \naligned_intptr\n \n=\n \naligned_biased_intptr\n \n&\n \n(\n~\n15\n);\n\n\n  \nreturn\n \n(\nchar\n*\n)\naligned_intptr\n;\n \n// warning: avoid integer to pointer casts [performance-no-int-to-ptr]\n\n\n}\n\nThe check will rightfully diagnose that cast.\n\nBut when provenance concealment is not the goal of the code, but an accident,\nthis example can be rewritten as follows, without using integer to pointer cast:\n\nchar\n*\n\n\ntgt\n(\nchar\n*\n \nmaybe_underbiased_ptr\n)\n \n{\n\n\n    \nuintptr_t\n \nmaybe_underbiased_intptr\n \n=\n \n(\nuintptr_t\n)\nmaybe_underbiased_ptr\n;\n\n\n    \nuintptr_t\n \naligned_biased_intptr\n \n=\n \nmaybe_underbiased_intptr\n \n+\n \n15\n;\n\n\n    \nuintptr_t\n \naligned_intptr\n \n=\n \naligned_biased_intptr\n \n&\n \n(\n~\n15\n);\n\n\n    \nuintptr_t\n \nbias\n \n=\n \naligned_intptr\n \n-\n \nmaybe_underbiased_intptr\n;\n\n\n    \nreturn\n \nmaybe_underbiased_ptr\n \n+\n \nbias\n;\n\n\n}",
    "configurations": []
  }
}