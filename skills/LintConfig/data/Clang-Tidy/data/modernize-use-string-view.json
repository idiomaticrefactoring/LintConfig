{
  "name": "modernize-use-string-view",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/modernize/use-string-view.html",
    "fixable": true
  },
  "content": {
    "introduction": "Looks for functions returning \nstd::[w|u8|u16|u32]string\n and suggests to\nchange it to \nstd::[...]string_view\n for performance reasons if possible.\n\nEach time a new \nstd::string\n is created from a literal, a copy of that\nliteral is allocated either in \nstd::string\nâs internal buffer\n(for short literals) or on the heap.\n\nFor the cases where \nstd::string\n is returned from a function,\nsuch allocations can sometimes be eliminated by using \nstd::string_view\n\nas a return type.\n\nThis check looks for such functions returning \nstd::string\n constructed from\nthe literals and suggests replacing their return type to \nstd::string_view\n.\n\nIt handles \nstd::string\n, \nstd::wstring\n, \nstd::u8string\n,\n\nstd::u16string\n and \nstd::u32string\n along with their aliases and selects\nthe proper kind of \nstd::string_view\n to return.\n\nConsider the following example:\n\nstd\n::\nstring\n \nfoo\n(\nint\n \ni\n)\n \n{\n\n\n  \nswitch\n(\ni\n)\n \n{\n\n\n    \ncase\n \n1\n:\n\n\n      \nreturn\n \n\"case 1\"\n;\n\n\n    \n...\n\n\n    \ndefault\n:\n\n\n      \nreturn\n \n\"default\"\n;\n\n\n  \n}\n\n\n}\n\nIn the code above a new \nstd::string\n object is created on each function\ninvocation, making a copy of a string literal and possibly allocating a memory\non the heap.\n\nThe check gets this code transformed into:\n\nstd\n::\nstring_view\n \nfoo\n(\nint\n \ni\n)\n \n{\n\n\n  \nswitch\n(\ni\n)\n \n{\n\n\n    \ncase\n \n1\n:\n\n\n      \nreturn\n \n\"case 1\"\n;\n\n\n    \n...\n\n\n    \ndefault\n:\n\n\n      \nreturn\n \n\"default\"\n;\n\n\n  \n}\n\n\n}\n\nNew version re-uses statically allocated literals without additional overhead.\n\nSuppressing diagnostic\nÂ¶\n\n\nTo prevent an undesired diagnostic wrap the string literal with an explicit\n\nstd::string(...)\n constructor:\n\n\nstd\n::\nstring\n \nfoo\n()\n \n{\n\n\n  \nreturn\n \n\"default\"\n;\n \n//warning and fix are generated\n\n\n}\n\n\n\nstd\n::\nstring\n \nbar\n()\n \n{\n\n\n  \nreturn\n \nstd\n::\nstring\n(\n\"default\"\n);\n \n//warning and fix are NOT generated\n\n\n}\n\nLimitations\nÂ¶\n\n\n\n\nNo warning and/or fix are generated as for now for these code patterns:\n\n\n\n\nreturn\n \nstd::string(\"literal\");\n\n\nreturn\n \nstd::string{\"literal\"};\n\n\nreturn\n \n\"simpleLiteral\"s;\n\n\nauto\n \nfoo()\n \n{\n \nreturn\n \n\"autoReturn\";\n \n}\n\n\nauto\n \nTrailing()\n \n->\n \nstd::string\n \n{\n \nreturn\n \n\"Trailing\";\n \n}\n warns, doesnât fix\n\n\nreturnings from lambda\n\n\ncomplicated macro and templated code\n\n\n\n\n\n\n\n\nIn some cases the fixed code will not compile due to lack of conversion from\n\nstd::string_view\n to \nstd::string\n. It can be fixed (preferably) by\nconverting receiver \nstd::string\n to \nstd::string_view\n if possible or\nsimply make an explicit conversion.\n\n\nstring\n \nfoo\n()\n \n{\n        \n// <--- will be replaced with string_view\n\n\n  \nreturn\n \n\"foo\"\n;\n\n\n}\n\n\n\nvoid\n \nbar\n()\n \n{\n\n\n  \nstring\n \nerr\n \n=\n \nfoo\n();\n \n// <----- error: no viable conversion from\n\n\n                      \n// 'std::string_view' (aka 'basic_string_view<char>')\n\n\n                      \n// to 'std::string' (aka 'basic_string<char>')\n\n\n\n  \nstring\n \nfix\n(\nfoo\n());\n  \n// <----- no errors\n\n\n}\n\nOptions\nÂ¶\n\n\n\n\n\n\nIgnoredFunctions\nÂ¶\n\n\nA semicolon-separated list of the names of functions or methods to be\nignored. Regular expressions are accepted, e.g. \n[Rr]ef(erence)?$\n matches\nevery type with suffix \nRef\n, \nref\n, \nReference\n and \nreference\n.\n\n\nIf a name in the list contains the sequence \n::\n it is matched against the\nqualified type name (i.e. \nnamespace::Type\n), otherwise it is matched\nagainst only the type name (i.e. \nType\n).\n\n\nThe default is \ntoString$;ToString$;to_string$\n.\n\n\n\n\n\n\n\n\nReplacementStringViewClass\nÂ¶\n\n\nA semicolon-separated list of \nstring=string_view\n pairs for replacing\n\nstring\n to \nstring_view\n counterparts.\n\n\n\n\n\n\nKey\n\n\nValue (example)\n\n\nDefault value\n\n\n\n\n\n\n\n\nstring\n\n\nllvm::StringRef\n\n\nstd::string_view\n\n\n\n\nwstring\n\n\nboost::wstring_view\n\n\nstd::wstring_view\n\n\n\n\nu8string\n\n\nabsl::u8string_view\n\n\nstd::u8string_view\n\n\n\n\nu16string\n\n\nQStringView\n\n\nstd::u16string_view\n\n\n\n\nu32string\n\n\nstd::u32zstring_view\n\n\nstd::u32string_view",
    "configurations": []
  }
}