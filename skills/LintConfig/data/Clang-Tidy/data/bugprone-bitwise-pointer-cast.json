{
  "name": "bugprone-bitwise-pointer-cast",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/bitwise-pointer-cast.html",
    "fixable": false
  },
  "content": {
    "introduction": "Warns about code that tries to cast between pointers by means of\n\nstd::bit_cast\n or \nmemcpy\n.\n\nThe motivation is that \nstd::bit_cast\n is advertised as the safe alternative\nto type punning via \nreinterpret_cast\n in modern C++. However, one should not\nblindly replace \nreinterpret_cast\n with \nstd::bit_cast\n, as follows:\n\nint\n \nx\n{};\n\n\n-\nfloat\n \ny\n \n=\n \n*\nreinterpret_cast\n<\nfloat\n*>\n(\n&\nx\n);\n\n\n+\nfloat\n \ny\n \n=\n \n*\nstd\n::\nbit_cast\n<\nfloat\n*>\n(\n&\nx\n);\n\nThe drop-in replacement behaves exactly the same as \nreinterpret_cast\n, and\nUndefined Behavior is still invoked. \nstd::bit_cast\n is copying the bytes of\nthe input pointer, not the pointee, into an output pointer of a different type,\nwhich may violate the strict aliasing rules. However, simply looking at the\ncode, it looks âsafeâ, because it uses \nstd::bit_cast\n which is advertised as\nsafe.\n\nThe solution to safe type punning is to apply \nstd::bit_cast\n on value types,\nnot on pointer types:\n\nint\n \nx\n{};\n\n\nfloat\n \ny\n \n=\n \nstd\n::\nbit_cast\n<\nfloat\n>\n(\nx\n);\n\nThis way, the bytes of the input object are copied into the output object,\nwhich is much safer. Do note that Undefined Behavior can still occur, if there\nis no value of type \nTo\n corresponding to the value representation produced.\nCompilers may be able to optimize this copy and generate identical assembly to\nthe original \nreinterpret_cast\n version.\n\nCode before C++20 may backport \nstd::bit_cast\n by means of \nmemcpy\n, or\nsimply call \nmemcpy\n directly, which is equally problematic. This is also\ndetected by this check:\n\nint\n*\n \nx\n{};\n\n\nfloat\n*\n \ny\n{};\n\n\nstd\n::\nmemcpy\n(\n&\ny\n,\n \n&\nx\n,\n \nsizeof\n(\nx\n));\n\nAlternatively, if a cast between pointers is truly wanted, \nreinterpret_cast\n\nshould be used, to clearly convey the intent and enable warnings from compilers\nand linters, which should be addressed accordingly.",
    "configurations": []
  }
}