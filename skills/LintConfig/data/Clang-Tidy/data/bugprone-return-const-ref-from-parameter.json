{
  "name": "bugprone-return-const-ref-from-parameter",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/return-const-ref-from-parameter.html",
    "fixable": false
  },
  "content": {
    "introduction": "Detects return statements that return a constant reference parameter as\nconstant reference. This may cause use-after-free errors if the caller\nuses xvalues as arguments.\n\nIn C++, constant reference parameters can accept xvalues which will be\ndestructed after the call. When the function returns such a parameter also\nas constant reference, then the returned reference can be used after the\nobject it refers to has been destroyed.\n\nExample\nÂ¶\n\n\nstruct\n \nS\n \n{\n\n\n  \nint\n \nv\n;\n\n\n  \nS\n(\nint\n);\n\n\n  \n~\nS\n();\n\n\n};\n\n\n\nconst\n \nS\n \n&\nfn\n(\nconst\n \nS\n \n&\na\n)\n \n{\n\n\n  \nreturn\n \na\n;\n\n\n}\n\n\n\nconst\n \nS\n&\n \ns\n \n=\n \nfn\n(\nS\n{\n1\n});\n\n\ns\n.\nv\n;\n \n// use after free\n\n\n\n\n\n\nThis issue can be resolved by declaring an overload of the problematic function\nwhere the \nconst\n \n&\n parameter is instead declared as \n&&\n. The developer has\nto ensure that the implementation of that function does not produce a\nuse-after-free, the exact error that this check is warning against.\nMarking such an \n&&\n overload as \ndeleted\n, will silence the warning as\nwell. In the case of different \nconst\n \n&\n parameters being returned depending\non the control flow of the function, an overload where all problematic\n\nconst\n \n&\n parameters have been declared as \n&&\n will resolve the issue.\n\n\nThis issue can also be resolved by adding \n[[clang::lifetimebound]]\n. Clang\nenable \n-Wdangling\n warning by default which can detect mis-uses of the\nannotated function. See \nlifetimebound attribute\n\nfor details.\n\n\nconst\n \nint\n \n&\nf\n(\nconst\n \nint\n \n&\na\n \n[[\nclang\n::\nlifetimebound\n]])\n \n{\n \nreturn\n \na\n;\n \n}\n \n// no warning\n\n\nconst\n \nint\n \n&\nv\n \n=\n \nf\n(\n1\n);\n \n// warning: temporary bound to local reference 'v' will be destroyed at the end of the full-expression [-Wdangling]",
    "configurations": []
  }
}