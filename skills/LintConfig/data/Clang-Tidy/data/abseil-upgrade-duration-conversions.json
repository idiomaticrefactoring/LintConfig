{
  "name": "abseil-upgrade-duration-conversions",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/abseil/upgrade-duration-conversions.html",
    "fixable": true
  },
  "content": {
    "introduction": "Finds calls to \nabsl::Duration\n arithmetic operators and factories whose\nargument needs an explicit cast to continue compiling after upcoming API\nchanges.\n\nThe operators \n*=\n, \n/=\n, \n*\n, and \n/\n for \nabsl::Duration\n currently\naccept an argument of class type that is convertible to an arithmetic type.\nSuch a call currently converts the value to an \nint64_t\n, even in a case such\nas \nstd::atomic<float>\n that would result in lossy conversion.\n\nAdditionally, the \nabsl::Duration\n factory functions (\nabsl::Hours\n,\n\nabsl::Minutes\n, etc) currently accept an \nint64_t\n or a floating-point\ntype. Similar to the arithmetic operators, calls with an argument of class type\nthat is convertible to an arithmetic type go through the \nint64_t\n path.\n\nThese operators and factories will be changed to only accept arithmetic types\nto prevent unintended behavior. After these changes are released, passing an\nargument of class type will no longer compile, even if the type is implicitly\nconvertible to an arithmetic type.\n\nHere are example fixes created by this check:\n\nstd\n::\natomic\n<\nint\n>\n \na\n;\n\n\nabsl\n::\nDuration\n \nd\n \n=\n \nabsl\n::\nMilliseconds\n(\na\n);\n\n\nd\n \n*=\n \na\n;\n\nbecomes\n\nstd\n::\natomic\n<\nint\n>\n \na\n;\n\n\nabsl\n::\nDuration\n \nd\n \n=\n \nabsl\n::\nMilliseconds\n(\nstatic_cast\n<\nint64_t\n>\n(\na\n));\n\n\nd\n \n*=\n \nstatic_cast\n<\nint64_t\n>\n(\na\n);\n\nNote that this check always adds a cast to \nint64_t\n in order to preserve the\ncurrent behavior of user code. It is possible that this uncovers unintended\nbehavior due to types implicitly convertible to a floating-point type.",
    "configurations": []
  }
}