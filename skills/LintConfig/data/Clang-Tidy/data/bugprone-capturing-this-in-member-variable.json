{
  "name": "bugprone-capturing-this-in-member-variable",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/capturing-this-in-member-variable.html",
    "fixable": false
  },
  "content": {
    "introduction": "Finds lambda captures that capture the \nthis\n pointer and store it as class\nmembers without handle the copy and move constructors and the assignments.\n\nCapture this in a lambda and store it as a class member is dangerous because\nthe lambda can outlive the object it captures. Especially when the object is\ncopied or moved, the captured \nthis\n pointer will be implicitly propagated\nto the new object. Most of the time, people will believe that the captured\n\nthis\n pointer points to the new object, which will lead to bugs.\n\nstruct\n \nC\n \n{\n\n\n  \nC\n()\n \n:\n \nCaptured\n([\nthis\n]()\n \n->\n \nC\n \nconst\n \n*\n \n{\n \nreturn\n \nthis\n;\n \n})\n \n{}\n\n\n  \nstd\n::\nfunction\n<\nC\n \nconst\n \n*\n()\n>\n \nCaptured\n;\n\n\n};\n\n\n\nvoid\n \nfoo\n()\n \n{\n\n\n  \nC\n \nv1\n{};\n\n\n  \nC\n \nv2\n \n=\n \nv1\n;\n \n// v2.Captured capture v1's 'this' pointer\n\n\n  \nassert\n(\nv2\n.\nCaptured\n()\n \n==\n \nv1\n.\nCaptured\n());\n \n// v2.Captured capture v1's 'this' pointer\n\n\n  \nassert\n(\nv2\n.\nCaptured\n()\n \n==\n \n&\nv2\n);\n \n// assertion failed.\n\n\n}\n\nPossible fixes:\n\n\nmarking copy and move constructors and assignment operators deleted.\n\n\nusing class member method instead of class member variable with function\nobject types.\n\n\npassing \nthis\n pointer as parameter.\n\nOptions\nÂ¶\n\n\n\n\n\n\nFunctionWrapperTypes\nÂ¶\n\n\nA semicolon-separated list of names of types. Used to specify function\nwrapper that can hold lambda expressions.\nDefault is \n::std::function;::std::move_only_function;::boost::function\n.\n\n\n\n\n\n\n\n\nBindFunctions\nÂ¶\n\n\nA semicolon-separated list of fully qualified names of functions that can\ncapture \nthis\n pointer.\nDefault is \n::std::bind;::boost::bind;::std::bind_front;::std::bind_back;\n::boost::compat::bind_front;::boost::compat::bind_back\n.",
    "configurations": []
  }
}