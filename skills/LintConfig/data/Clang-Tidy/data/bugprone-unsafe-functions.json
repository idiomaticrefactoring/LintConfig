{
  "name": "bugprone-unsafe-functions",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/unsafe-functions.html",
    "fixable": false
  },
  "content": {
    "introduction": "Checks for functions that have safer, more secure replacements available, or\nare considered deprecated due to design flaws.\nThe check heavily relies on the functions from the\n\nAnnex K.\n âBounds-checking interfacesâ of C11.\n\nThe check implements the following rules from the CERT C Coding Standard:\n\n\nRecommendation \nMSC24-C. Do not use deprecated or obsolescent functions\n.\n\n\nRule \nMSC33-C. Do not pass invalid data to the asctime() function\n.\n\ncert-msc24-c\n and \ncert-msc33-c\n redirect here as aliases of this check.\n\nUnsafe functions\nÂ¶\n\n\nThe following functions are reported if \nReportDefaultFunctions\n\nis enabled.\n\n\nIf \nAnnex K.\n is available, a replacement from \nAnnex K.\n is suggested for the\nfollowing functions:\n\n\nasctime\n, \nasctime_r\n, \nbsearch\n, \nctime\n, \nfopen\n, \nfprintf\n,\n\nfreopen\n, \nfscanf\n, \nfwprintf\n, \nfwscanf\n, \ngetenv\n, \ngets\n,\n\ngmtime\n, \nlocaltime\n, \nmbsrtowcs\n, \nmbstowcs\n, \nmemcpy\n,\n\nmemmove\n, \nmemset\n, \nprintf\n, \nqsort\n, \nscanf\n,  \nsnprintf\n,\n\nsprintf\n,  \nsscanf\n, \nstrcat\n, \nstrcpy\n, \nstrerror\n, \nstrlen\n,\n\nstrncat\n, \nstrncpy\n, \nstrtok\n, \nswprintf\n, \nswscanf\n, \nvfprintf\n,\n\nvfscanf\n, \nvfwprintf\n, \nvfwscanf\n, \nvprintf\n, \nvscanf\n,\n\nvsnprintf\n, \nvsprintf\n, \nvsscanf\n, \nvswprintf\n, \nvswscanf\n,\n\nvwprintf\n, \nvwscanf\n, \nwcrtomb\n, \nwcscat\n, \nwcscpy\n,\n\nwcslen\n, \nwcsncat\n, \nwcsncpy\n, \nwcsrtombs\n, \nwcstok\n, \nwcstombs\n,\n\nwctomb\n, \nwmemcpy\n, \nwmemmove\n, \nwprintf\n, \nwscanf\n.\n\n\nIf \nAnnex K.\n is not available, replacements are suggested only for the\nfollowing functions from the previous list:\n\n\n\n\n\n\nasctime\n, \nasctime_r\n, suggested replacement: \nstrftime\n\n\ngets\n, suggested replacement: \nfgets\n\n\n\n\n\n\nThe following functions are always checked, regardless of \nAnnex K\n\navailability:\n\n\n\n\n\n\nrewind\n, suggested replacement: \nfseek\n\n\nsetbuf\n, suggested replacement: \nsetvbuf\n\n\nstd::get_temporary_buffer\n, suggested replacement: âplainâ allocation\nwith \noperator\n \nnew[]\n\n\n\n\n\n\nIf \nReportMoreUnsafeFunctions\n is enabled,\nthe following functions are also checked:\n\n\n\n\n\n\nbcmp\n, suggested replacement: \nmemcmp\n\n\nbcopy\n, suggested replacement: \nmemcpy_s\n if \nAnnex K\n is available,\nor \nmemcpy\n\n\nbzero\n, suggested replacement: \nmemset_s\n if \nAnnex K\n is available,\nor \nmemset\n\n\ngetpw\n, suggested replacement: \ngetpwuid\n\n\nvfork\n, suggested replacement: \nposix_spawn\n\n\n\n\n\n\nAlthough mentioned in the associated CERT rules, the following functions are\n\nignored\n by the check:\n\n\natof\n, \natoi\n, \natol\n, \natoll\n, \ntmpfile\n.\n\n\nThe availability of \nAnnex K\n is determined based on the following macros:\n\n\n\n\n\n\n__STDC_LIB_EXT1__\n: feature macro, which indicates the presence of\n\nAnnex K. âBounds-checking interfacesâ\n in the library implementation\n\n\n__STDC_WANT_LIB_EXT1__\n: user-defined macro, which indicates that the\nuser requests the functions from \nAnnex K.\n to be defined.\n\n\n\n\n\n\nBoth macros have to be defined to suggest replacement functions from \nAnnex K.\n\n\n__STDC_LIB_EXT1__\n is defined by the library implementation, and\n\n__STDC_WANT_LIB_EXT1__\n must be defined to \n1\n by the user \nbefore\n\nincluding any system headers.\n\nCustom functions\nÂ¶\n\n\nThe option \nCustomFunctions\n allows the user to define custom functions\nto be checked. The format is the following, without newlines:\n\n\nbugprone\n-\nunsafe\n-\nfunctions\n.\nCustomFunctions\n=\n\"\n\n  \nfunctionRegex1\n[,\n \nreplacement1\n[,\n \nreason1\n]];\n\n  \nfunctionRegex2\n[,\n \nreplacement2\n[,\n \nreason2\n]];\n\n  \n...\n\n\n\"\n\n\n\n\n\n\nThe functions are matched using POSIX extended regular expressions.\n\n(Note: The regular expressions do not support negative\n \n(?!)\n \nmatches.)\n\n\nThe \nreason\n is optional and is used to provide additional information about\nthe reasoning behind the replacement. The default reason is\n\nis marked as unsafe\n.\n\n\nIf \nreplacement\n is empty, the default text \nit should not be used\n will be\nshown instead of the suggestion for a replacement.\n\n\nIf the \nreason\n starts with the character \n>\n, the reason becomes fully\ncustom. The default suffix is disabled even if a \nreplacement\n is present,\nand only the reason message is shown after the matched function, to allow\nbetter control over the suggestions. (The starting \n>\n and whitespace\ndirectly after it are trimmed from the message.)\n\n\nAs an example, the following configuration matches only the function\n\noriginal\n in the default namespace. A similar diagnostic can also be printed\nusing a fully custom reason.\n\n\n// bugprone-unsafe-functions.CustomFunctions:\n\n\n//   ^original$, replacement, is deprecated;\n\n\n// Using the fully custom message syntax:\n\n\n//   ^suspicious$,,> should be avoided if possible.\n\n\noriginal\n();\n \n// warning: function 'original' is deprecated; 'replacement' should be used instead.\n\n\nsuspicious\n();\n \n// warning: function 'suspicious' should be avoided if possible.\n\n\n::\nstd\n::\noriginal\n();\n \n// no-warning\n\n\noriginal_function\n();\n \n// no-warning\n\n\n\n\n\n\nIf the regular expression contains the character \n:\n, it is matched against\nthe qualified name (i.e. \nstd::original\n), otherwise the regex is matched\nagainst the unqualified name (\noriginal\n). If the regular expression starts\nwith \n::\n (or \n^::\n), it is matched against the fully qualified name\n(\n::std::original\n).\n\n\nOne of the use cases for fully custom messages is suggesting compiler options\nand warning flags:\n\n\n// bugprone-unsafe-functions.CustomFunctions:\n\n\n//   ^memcpy$,,>is recommended to have compiler hardening using '_FORTIFY_SOURCE';\n\n\n//   ^printf$,,>is recommended to have the '-Werror=format-security' compiler warning flag;\n\n\n\nmemcpy\n(\ndest\n,\n \nsrc\n,\n \n999'999\n);\n \n// warning: function 'memcpy' is recommended to have compiler hardening using '_FORTIFY_SOURCE'\n\n\nprintf\n(\nraw_str\n);\n \n// warning: function 'printf' is recommended to have the '-Werror=format-security' compiler warning flag\n\n\n\n\n\n\n\n\nNote\n\n\nFully qualified names can contain template parameters on certain C++ classes,\nbut not on C++ functions. Type aliases are resolved before matching.\n\n\nAs an example, the member function \nopen\n in the class \nstd::ifstream\n\nhas a fully qualified name of \n::std::basic_ifstream<char>::open\n.\n\n\nThe example could also be matched with the regex\n\n::std::basic_ifstream<[^>]*>::open\n, which matches all potential template\nparameters, but does not match nested template classes.\n\nOptions\nÂ¶\n\n\n\n\n\n\nReportMoreUnsafeFunctions\nÂ¶\n\n\nWhen \ntrue\n, additional functions from widely used APIs (such as POSIX) are\nadded to the list of reported functions.\nSee the main documentation of the check for the complete list as to what\nthis option enables.\nDefault is \ntrue\n.\n\n\n\n\n\n\n\n\nReportDefaultFunctions\nÂ¶\n\n\nWhen \ntrue\n, the check reports the default set of functions.\nConsider changing the setting to false if you only want to see custom\nfunctions matched via \ncustom functions\n.\nDefault is \ntrue\n.\n\n\n\n\n\n\n\n\nCustomFunctions\nÂ¶\n\n\nA semicolon-separated list of custom functions to be matched. A matched\nfunction contains a regular expression, an optional name of the replacement\nfunction, and an optional reason, separated by comma. For more information,\nsee \nCustom functions\n.\n\nExamples\nÂ¶\n\n\n#ifndef __STDC_LIB_EXT1__\n\n\n#error \"Annex K is not supported by the current standard library implementation.\"\n\n\n#endif\n\n\n\n#define __STDC_WANT_LIB_EXT1__ 1\n\n\n\n#include\n \n<string.h>\n // Defines functions from Annex K.\n\n\n#include\n \n<stdio.h>\n\n\n\nenum\n \n{\n \nBUFSIZE\n \n=\n \n32\n \n};\n\n\n\nvoid\n \nUnsafe\n(\nconst\n \nchar\n \n*\nMsg\n)\n \n{\n\n\n  \nstatic\n \nconst\n \nchar\n \nPrefix\n[]\n \n=\n \n\"Error: \"\n;\n\n\n  \nstatic\n \nconst\n \nchar\n \nSuffix\n[]\n \n=\n \n\"\n\\n\n\"\n;\n\n\n  \nchar\n \nBuf\n[\nBUFSIZE\n]\n \n=\n \n{\n0\n};\n\n\n\n  \nstrcpy\n(\nBuf\n,\n \nPrefix\n);\n \n// warning: function 'strcpy' is not bounds-checking; 'strcpy_s' should be used instead.\n\n\n  \nstrcat\n(\nBuf\n,\n \nMsg\n);\n    \n// warning: function 'strcat' is not bounds-checking; 'strcat_s' should be used instead.\n\n\n  \nstrcat\n(\nBuf\n,\n \nSuffix\n);\n \n// warning: function 'strcat' is not bounds-checking; 'strcat_s' should be used instead.\n\n\n  \nif\n \n(\nfputs\n(\nbuf\n,\n \nstderr\n)\n \n<\n \n0\n)\n \n{\n\n\n    \n// error handling\n\n\n    \nreturn\n;\n\n\n  \n}\n\n\n}\n\n\n\nvoid\n \nUsingSafeFunctions\n(\nconst\n \nchar\n \n*\nMsg\n)\n \n{\n\n\n  \nstatic\n \nconst\n \nchar\n \nPrefix\n[]\n \n=\n \n\"Error: \"\n;\n\n\n  \nstatic\n \nconst\n \nchar\n \nSuffix\n[]\n \n=\n \n\"\n\\n\n\"\n;\n\n\n  \nchar\n \nBuf\n[\nBUFSIZE\n]\n \n=\n \n{\n0\n};\n\n\n\n  \nif\n \n(\nstrcpy_s\n(\nBuf\n,\n \nBUFSIZE\n,\n \nPrefix\n)\n \n!=\n \n0\n)\n \n{\n\n\n    \n// error handling\n\n\n    \nreturn\n;\n\n\n  \n}\n\n\n\n  \nif\n \n(\nstrcat_s\n(\nBuf\n,\n \nBUFSIZE\n,\n \nMsg\n)\n \n!=\n \n0\n)\n \n{\n\n\n    \n// error handling\n\n\n    \nreturn\n;\n\n\n  \n}\n\n\n\n  \nif\n \n(\nstrcat_s\n(\nBuf\n,\n \nBUFSIZE\n,\n \nSuffix\n)\n \n!=\n \n0\n)\n \n{\n\n\n    \n// error handling\n\n\n    \nreturn\n;\n\n\n  \n}\n\n\n\n  \nif\n \n(\nfputs\n(\nBuf\n,\n \nstderr\n)\n \n<\n \n0\n)\n \n{\n\n\n    \n// error handling\n\n\n    \nreturn\n;\n\n\n  \n}\n\n\n}",
    "configurations": []
  }
}