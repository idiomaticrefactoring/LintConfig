{
  "name": "bugprone-suspicious-stringview-data-usage",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/bugprone/suspicious-stringview-data-usage.html",
    "fixable": false
  },
  "content": {
    "introduction": "Identifies suspicious usages of \nstd::string_view::data()\n that could lead to\nreading out-of-bounds data due to inadequate or incorrect string null\ntermination.\n\nIt warns when the result of \ndata()\n is passed to a constructor or function\nwithout also passing the corresponding result of \nsize()\n or \nlength()\n\nmember function. Such usage can lead to unintended behavior, particularly when\nassuming the data pointed to by \ndata()\n is null-terminated.\n\nThe absence of a \nc_str()\n method in \nstd::string_view\n often leads\ndevelopers to use \ndata()\n as a substitute, especially when interfacing with\nC APIs that expect null-terminated strings. However, since \ndata()\n does not\nguarantee null termination, this can result in unintended behavior if the API\nrelies on proper null termination for correct string interpretation.\n\nIn todayâs programming landscape, this scenario can occur when implicitly\nconverting an \nstd::string_view\n to an \nstd::string\n. Since the constructor\nin \nstd::string\n designed for string-view-like objects is \nexplicit\n,\nattempting to pass an \nstd::string_view\n to a function expecting an\n\nstd::string\n will result in a compilation error. As a workaround, developers\nmay be tempted to utilize the \n.data()\n method to achieve compilation,\nintroducing potential risks.\n\nFor instance:\n\nvoid\n \nprintString\n(\nconst\n \nstd\n::\nstring\n&\n \nstr\n)\n \n{\n\n\n  \nstd\n::\ncout\n \n<<\n \n\"String: \"\n \n<<\n \nstr\n \n<<\n \nstd\n::\nendl\n;\n\n\n}\n\n\n\nvoid\n \nsomething\n(\nstd\n::\nstring_view\n \nsv\n)\n \n{\n\n\n  \nprintString\n(\nsv\n.\ndata\n());\n\n\n}\n\nIn this example, directly passing \nsv\n to the \nprintString\n function would\nlead to a compilation error due to the explicit nature of the \nstd::string\n\nconstructor. Consequently, developers might opt for \nsv.data()\n to resolve the\ncompilation error, albeit introducing potential hazards as discussed.\n\nOptions\nÂ¶\n\n\n\n\n\n\nStringViewTypes\nÂ¶\n\n\nOption allows users to specify custom string view-like types for analysis. It\naccepts a semicolon-separated list of type names or regular expressions\nmatching these types. Default value is:\n\n::std::basic_string_view;::llvm::StringRef\n.\n\n\n\n\n\n\n\n\nAllowedCallees\nÂ¶\n\n\nSpecifies methods, functions, or classes where the result of \n.data()\n is\npassed to. Allows to exclude such calls from the analysis. Accepts a\nsemicolon-separated list of names or regular expressions matching these\nentities. Default value is: empty string.",
    "configurations": []
  }
}