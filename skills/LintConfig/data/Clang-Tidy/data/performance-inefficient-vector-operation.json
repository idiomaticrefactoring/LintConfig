{
  "name": "performance-inefficient-vector-operation",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/performance/inefficient-vector-operation.html",
    "fixable": true
  },
  "content": {
    "introduction": "Finds possible inefficient \nstd::vector\n operations (e.g. \npush_back\n,\n\nemplace_back\n) that may cause unnecessary memory reallocations.\n\nIt can also find calls that add element to protobuf repeated field in a loop\nwithout calling Reserve() before the loop. Calling Reserve() first can avoid\nunnecessary memory reallocations.\n\nCurrently, the check only detects following kinds of loops with a single\nstatement body:\n\nCounter-based for loops start with 0:\n\nstd\n::\nvector\n<\nint\n>\n \nv\n;\n\n\nfor\n \n(\nint\n \ni\n \n=\n \n0\n;\n \ni\n \n<\n \nn\n;\n \n++\ni\n)\n \n{\n\n\n  \nv\n.\npush_back\n(\nn\n);\n\n\n  \n// This will trigger the warning since the push_back may cause multiple\n\n\n  \n// memory reallocations in v. This can be avoid by inserting a 'reserve(n)'\n\n\n  \n// statement before the for statement.\n\n\n}\n\n\n\nSomeProto\n \np\n;\n\n\nfor\n \n(\nint\n \ni\n \n=\n \n0\n;\n \ni\n \n<\n \nn\n;\n \n++\ni\n)\n \n{\n\n\n  \np\n.\nadd_xxx\n(\nn\n);\n\n\n  \n// This will trigger the warning since the add_xxx may cause multiple memory\n\n\n  \n// reallocations. This can be avoid by inserting a\n\n\n  \n// 'p.mutable_xxx().Reserve(n)' statement before the for statement.\n\n\n}\n\nFor-range loops like \nfor\n \n(range-declaration\n \n:\n \nrange_expression)\n, the type\nof \nrange_expression\n can be \nstd::vector\n, \nstd::array\n,\n\nstd::deque\n, \nstd::set\n, \nstd::unordered_set\n, \nstd::map\n,\n\nstd::unordered_set\n:\n\nstd\n::\nvector\n<\nint\n>\n \ndata\n;\n\n\nstd\n::\nvector\n<\nint\n>\n \nv\n;\n\n\n\nfor\n \n(\nauto\n \nelement\n \n:\n \ndata\n)\n \n{\n\n\n  \nv\n.\npush_back\n(\nelement\n);\n\n\n  \n// This will trigger the warning since the 'push_back' may cause multiple\n\n\n  \n// memory reallocations in v. This can be avoid by inserting a\n\n\n  \n// 'reserve(data.size())' statement before the for statement.\n\n\n}\n\nOptions\nÂ¶\n\n\n\n\n\n\nVectorLikeClasses\nÂ¶\n\n\nSemicolon-separated list of names of vector-like classes. By default only\n\n::std::vector\n is considered.\n\n\n\n\n\n\n\n\nEnableProto\nÂ¶\n\n\nWhen \ntrue\n, the check will also warn on inefficient operations for proto\nrepeated fields. Otherwise, the check only warns on inefficient vector\noperations. Default is \nfalse\n.",
    "configurations": []
  }
}