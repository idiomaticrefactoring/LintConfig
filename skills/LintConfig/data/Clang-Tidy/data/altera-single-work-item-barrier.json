{
  "name": "altera-single-work-item-barrier",
  "meta": {
    "url": "https://clang.llvm.org/extra/clang-tidy/checks/altera/single-work-item-barrier.html",
    "fixable": false
  },
  "content": {
    "introduction": "Finds OpenCL kernel functions that call a barrier function but do not call\nan ID function (\nget_local_id\n, \nget_local_id\n, \nget_group_id\n, or\n\nget_local_linear_id\n).\n\nThese kernels may be viable single work-item kernels, but will be forced to\nexecute as NDRange kernels if using a newer version of the Altera Offline\nCompiler (>= v17.01).\n\nIf using an older version of the Altera Offline Compiler, these kernel\nfunctions will be treated as single work-item kernels, which could be\ninefficient or lead to errors if NDRange semantics were intended.\n\nBased on the \nAltera SDK for OpenCL: Best Practices Guide\n.\n\nExamples:\n\n// error: function calls barrier but does not call an ID function.\n\n\nvoid\n \n__kernel\n \nbarrier_no_id\n(\n__global\n \nint\n \n*\n \nfoo\n,\n \nint\n \nsize\n)\n \n{\n\n\n  \nfor\n \n(\nint\n \ni\n \n=\n \n0\n;\n \ni\n \n<\n \n100\n;\n \ni\n++\n)\n \n{\n\n\n    \nfoo\n[\ni\n]\n \n+=\n \n5\n;\n\n\n  \n}\n\n\n  \nbarrier\n(\nCLK_GLOBAL_MEM_FENCE\n);\n\n\n}\n\n\n\n// ok: function calls barrier and an ID function.\n\n\nvoid\n \n__kernel\n \nbarrier_with_id\n(\n__global\n \nint\n \n*\n \nfoo\n,\n \nint\n \nsize\n)\n \n{\n\n\n  \nfor\n \n(\nint\n \ni\n \n=\n \n0\n;\n \ni\n \n<\n \n100\n;\n \ni\n++\n)\n \n{\n\n\n    \nint\n \ntid\n \n=\n \nget_global_id\n(\n0\n);\n\n\n    \nfoo\n[\ntid\n]\n \n+=\n \n5\n;\n\n\n  \n}\n\n\n  \nbarrier\n(\nCLK_GLOBAL_MEM_FENCE\n);\n\n\n}\n\n\n\n// ok with AOC Version 17.01: the reqd_work_group_size turns this into\n\n\n// an NDRange.\n\n\n__attribute__\n((\nreqd_work_group_size\n(\n2\n,\n2\n,\n2\n)))\n\n\nvoid\n \n__kernel\n \nbarrier_with_id\n(\n__global\n \nint\n \n*\n \nfoo\n,\n \nint\n \nsize\n)\n \n{\n\n\n  \nfor\n \n(\nint\n \ni\n \n=\n \n0\n;\n \ni\n \n<\n \n100\n;\n \ni\n++\n)\n \n{\n\n\n    \nfoo\n[\ntid\n]\n \n+=\n \n5\n;\n\n\n  \n}\n\n\n  \nbarrier\n(\nCLK_GLOBAL_MEM_FENCE\n);\n\n\n}\n\nOptions\nÂ¶\n\n\n\n\n\n\nAOCVersion\nÂ¶\n\n\nDefines the version of the Altera Offline Compiler. Defaults to \n1600\n\n(corresponding to version 16.00).",
    "configurations": []
  }
}